## Milestone: Program Years — Admin Pages

> **Validates:**
> - Frontend `/program-years` (authenticated) renders an element with `data-testid="program-years-heading"`
> - Frontend `/program-years/new` renders an input with `data-testid="name-input"` and a button with `data-testid="submit-button"`

> **Reference files:**
> - `src/Stretto.Web/src/pages/LoginPage.tsx` — pattern for React Hook Form + Zod + navigation
> - `src/Stretto.Web/src/App.tsx` — replace `/program-years` placeholder and add nested routes here

- [x] Fix `AppShell` in `src/Stretto.Web/src/components/AppShell.tsx`: for each of the three nav sections (desktop `lg+` sidebar, tablet `md–lg` sidebar, mobile bottom bar), append a suffix to every `data-testid` to make them unique across the DOM — change `data-testid={`nav-${item.label...}`}` to `data-testid={`nav-desktop-${item.label...}`}` in the desktop nav, `data-testid={`nav-tablet-${item.label...}`}` in the tablet nav, and `data-testid={`nav-mobile-${item.label...}`}` in the mobile bottom bar (fixes finding #67 — duplicate testids break e2e selectors)

- [x] Fix auth store in `src/Stretto.Web/src/stores/authStore.ts` to persist the user across page refreshes: change the initial state to read from localStorage — `user: (() => { try { const raw = localStorage.getItem('stretto_user'); return raw ? JSON.parse(raw) as AuthUser : null; } catch { return null; } })()`; in `setUser`, call `localStorage.setItem('stretto_user', JSON.stringify(u))` before `set({ user: u })`; in `clearUser`, call `localStorage.removeItem('stretto_user')` before `set({ user: null })` (fixes finding #66 — page refresh always redirected unauthenticated users to /login)

- [ ] Regenerate the TypeScript API client: start the backend with `dotnet run --project src/Stretto.Api/ -- --urls http://localhost:5000` so Swagger is reachable at `http://localhost:5000/swagger/v1/swagger.json`, then run `npm run generate` from `src/Stretto.Web/`; commit the generated files in `src/Stretto.Web/src/api/generated/`

- [ ] Create `src/Stretto.Web/src/pages/ProgramYearsListPage.tsx`; import `useQuery`, `useMutation`, `useQueryClient` from `@tanstack/react-query`; import `Link` from `react-router-dom`; import `format`, `parseISO` from `date-fns`; import `AppShell` from `../components/AppShell`; `useQuery({ queryKey: ['program-years'], queryFn: () => fetch('/api/program-years', { credentials: 'include' }).then(r => r.json()) })`; render inside `<AppShell>`: `<h1 data-testid="program-years-heading">Program Years</h1>`, a `<Link to="/program-years/new" data-testid="add-program-year-button">New Program Year</Link>` styled as a button, and a list where each row shows Name, start/end dates formatted as `format(parseISO(py.startDate), 'MMM d, yyyy')`, a `<span data-testid={`current-badge-${py.id}`}>Current</span>` badge when `py.isCurrent`, an `<span data-testid={`archived-badge-${py.id}`}>Archived</span>` badge when `py.isArchived`, a `<Link to={`/program-years/${py.id}`} data-testid={`view-${py.id}`}>View</Link>`, an `<button data-testid={`archive-${py.id}`}>Archive</button>` (hidden when `py.isArchived`) wired to `useMutation` posting to `/api/program-years/${py.id}/archive`, and an `<button data-testid={`activate-${py.id}`}>Activate</button>` (hidden when `py.isCurrent || py.isArchived`) wired to `useMutation` posting to `/api/program-years/${py.id}/activate`; both mutations call `queryClient.invalidateQueries({ queryKey: ['program-years'] })` on success

- [ ] Create `src/Stretto.Web/src/pages/ProgramYearCreatePage.tsx`; import `useNavigate` from `react-router-dom`; import `useForm` from `react-hook-form`; import `zodResolver` from `@hookform/resolvers/zod`; import `z` from `zod`; import `useMutation` from `@tanstack/react-query`; import `AppShell`; define schema `z.object({ name: z.string().min(1,'Name is required'), startDate: z.string().min(1,'Start date is required'), endDate: z.string().min(1,'End date is required') })`; derive `FormValues` type with `z.infer`; wire `useForm<FormValues>` with the resolver; `useMutation` that posts `JSON.stringify(values)` to `POST /api/program-years` (`credentials: 'include'`) and navigates to `/program-years` on success; render inside `<AppShell>`: `<h1>New Program Year</h1>` and a form with labeled inputs `<input data-testid="name-input" {...register('name')} />`, `<input type="date" data-testid="start-date-input" {...register('startDate')} />`, `<input type="date" data-testid="end-date-input" {...register('endDate')} />`, and `<button type="submit" data-testid="submit-button" disabled={isSubmitting}>Create Program Year</button>`; display `formState.errors` inline below each field

- [ ] Create `src/Stretto.Web/src/pages/ProgramYearDetailPage.tsx`; import `useParams`, `useNavigate`; import `useQuery`, `useMutation`, `useQueryClient`; import `useForm`, `zodResolver`; import `z`; import `AppShell`; read `id` from `useParams()`; `useQuery({ queryKey: ['program-year', id], queryFn: () => fetch(`/api/program-years/${id}`, { credentials: 'include' }).then(r => r.json()) })`; call `reset(data)` in a `useEffect` when query data loads; use same Zod schema as create page; render inside `<AppShell>`: edit form with `<input data-testid="name-input" />`, `<input type="date" data-testid="start-date-input" />`, `<input type="date" data-testid="end-date-input" />`, and `<button type="submit" data-testid="save-button">Save</button>` wired to `useMutation` PUTting to `/api/program-years/:id`; below the form show `<button data-testid="archive-button">Archive</button>` (when `!data.isArchived`) wired to `useMutation` POSTing to `/api/program-years/${id}/archive` with `onSuccess: () => { queryClient.invalidateQueries(...); navigate('/program-years'); }`; show `<button data-testid="activate-button">Activate</button>` (when `!data.isCurrent && !data.isArchived`) wired to `useMutation` POSTing to `/api/program-years/${id}/activate` with `onSuccess: () => queryClient.invalidateQueries(...)`)

- [ ] Update `src/Stretto.Web/src/App.tsx`: import `ProgramYearsListPage`, `ProgramYearCreatePage`, `ProgramYearDetailPage` from their page files; replace `<Route path="/program-years" element={<ComingSoon />} />` with `<Route path="/program-years" element={<ProgramYearsListPage />} />`; add inside the `<Route element={<ProtectedRoute />}>` block: `<Route path="/program-years/new" element={<ProgramYearCreatePage />} />` and `<Route path="/program-years/:id" element={<ProgramYearDetailPage />} />`
