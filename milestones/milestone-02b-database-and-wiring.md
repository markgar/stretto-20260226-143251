## Milestone: Database + Infrastructure + API Wiring

> **Validates:**
> - `dotnet build Stretto.sln` exits 0 from the repository root
> - `dotnet test Stretto.sln` exits 0 and all tests pass
> - `GET /health` returns HTTP 200 with body `{"status":"healthy"}` when the API is running
> - On startup, the in-memory database is seeded; `GET /swagger/v1/swagger.json` is served and includes at least the health endpoint

> **Reference files:**
> - `src/Stretto.Api/Program.cs` — entry point; DI registration and middleware pipeline pattern to follow when adding new services
> - `src/Stretto.Infrastructure/Stretto.Infrastructure.csproj` — project reference and NuGet package pattern for adding EF Core packages

- [ ] Add `Microsoft.EntityFrameworkCore` NuGet package to `Stretto.Infrastructure`; create `AppDbContext` in `Stretto.Infrastructure/Data/AppDbContext.cs` with `DbSet<T>` for all 12 entities (Organization, Member, ProgramYear, Venue, Project, Event, ProjectAssignment, AttendanceRecord, AuditionDate, AuditionSlot, ProjectLink, ProjectDocument); call `modelBuilder.ApplyConfigurationsFromAssembly(typeof(AppDbContext).Assembly)` in `OnModelCreating`
- [ ] Add `OrganizationConfiguration` and `MemberConfiguration` implementing `IEntityTypeConfiguration<T>` in `Stretto.Infrastructure/Data/Configurations/`; use Fluent API only — configure primary key, required string properties with max lengths (Name/Email max 255), and enum-to-string conversion for `Role`
- [ ] Add `ProgramYearConfiguration` and `VenueConfiguration` implementing `IEntityTypeConfiguration<T>` in `Stretto.Infrastructure/Data/Configurations/`; configure primary keys, required properties, optional nullable strings (ContactName max 200, ContactEmail max 255, ContactPhone max 50)
- [ ] Add `ProjectConfiguration`, `EventConfiguration`, and `ProjectAssignmentConfiguration` implementing `IEntityTypeConfiguration<T>` in `Stretto.Infrastructure/Data/Configurations/`; configure primary keys, required properties, enum-to-string conversion for `EventType`; Event.VenueId is optional (nullable FK)
- [ ] Add `AttendanceRecordConfiguration`, `AuditionDateConfiguration`, `AuditionSlotConfiguration`, `ProjectLinkConfiguration`, and `ProjectDocumentConfiguration` implementing `IEntityTypeConfiguration<T>` in `Stretto.Infrastructure/Data/Configurations/`; configure primary keys, required properties, enum-to-string conversions for `AttendanceStatus` and `AuditionStatus`; AuditionSlot.MemberId and AuditionSlot.Notes are optional
- [ ] Create `BaseRepository<T>` in `Stretto.Infrastructure/Repositories/BaseRepository.cs` implementing `IRepository<T>` where `T : class`; constructor takes `AppDbContext context`; `ListAsync(Guid orgId, ...)` filters by `EF.Property<Guid>(e, "OrganizationId") == orgId` (or cast via reflection); `GetByIdAsync(Guid id, Guid orgId)` finds by Id then verifies OrganizationId matches; `AddAsync`, `UpdateAsync`, `DeleteAsync` delegate to `context.Set<T>()`
- [ ] Create `DataSeeder` in `Stretto.Infrastructure/Data/DataSeeder.cs` with `static async Task SeedAsync(AppDbContext db)` method; checks if any Organization rows exist — if not, inserts: Organization `{Id = Guid.Parse("11111111-1111-1111-1111-111111111111"), Name = "My Choir", CreatedAt = DateTime.UtcNow}`, admin Member `{Email = "mgarner22@gmail.com", FirstName = "Admin", LastName = "User", Role = Role.Admin, IsActive = true, OrganizationId = org.Id}`, member Member `{Email = "mgarner@outlook.com", FirstName = "Member", LastName = "User", Role = Role.Member, IsActive = true, OrganizationId = org.Id}`; calls `SaveChangesAsync`
- [ ] Create `GlobalExceptionHandlerMiddleware` in `Stretto.Api/Middleware/GlobalExceptionHandlerMiddleware.cs`; in `InvokeAsync` wrap `await _next(context)` in try/catch; catch `NotFoundException` → write 404 JSON `{"message":"..."}`, catch `ValidationException` → write 400 JSON `{"message":"Validation failed","errors":{...}}`, catch unhandled `Exception` → write 500 JSON `{"message":"An unexpected error occurred"}`; set `Content-Type: application/json` on all error responses
- [ ] Register services in `Stretto.Api/Program.cs`: add `builder.Services.AddDbContext<AppDbContext>(o => o.UseInMemoryDatabase("StrettoDB"))`, add `builder.Services.AddScoped(typeof(IRepository<>), typeof(BaseRepository<>))`; add `app.UseMiddleware<GlobalExceptionHandlerMiddleware>()` before route mappings; after `app.Build()`, resolve `AppDbContext` from the DI scope and call `DataSeeder.SeedAsync`; add required `using` statements for Infrastructure and Application namespaces
