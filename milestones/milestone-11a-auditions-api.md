## Milestone: Auditions — Admin Setup API

> **Validates:**
> - `GET /api/audition-dates?programYearId={id}` without a session cookie returns HTTP 401
> - `POST /api/auth/login` with `mgarner22@gmail.com`; then `GET /api/program-years` to obtain a program year id; then `POST /api/audition-dates` with body `{"programYearId":"<id>","date":"<date>","startTime":"09:00","endTime":"12:00","blockLengthMinutes":30}` returns HTTP 201 with JSON body containing `id`, `programYearId`, `date`, `startTime`, `endTime`, `blockLengthMinutes`, `slotCount` (value 6)
> - `GET /api/audition-dates?programYearId=<id>` returns HTTP 200 with a JSON array containing the created audition date
> - `GET /api/audition-dates/{id}` returns HTTP 200 with matching `date` and `blockLengthMinutes`
> - `GET /api/audition-dates/{id}/slots` returns HTTP 200 with a JSON array of 6 slot objects each having `id`, `slotTime`, `status` (value `"Pending"`), `notes` (null)
> - `POST /api/audition-dates` with body `{"programYearId":"<id>","date":"<date>","startTime":"09:00","endTime":"10:00","blockLengthMinutes":25}` returns HTTP 422 (block does not divide evenly into 60 minutes)
> - `PATCH /api/audition-dates/{id}/slots/{slotId}` with body `{"status":"Accepted","notes":"Great voice"}` returns HTTP 200 with `status` equal to `"Accepted"` and `notes` equal to `"Great voice"`
> - `DELETE /api/audition-dates/{id}` returns HTTP 204; subsequent `GET /api/audition-dates/{id}` returns HTTP 404
> - `POST /api/audition-dates` authenticated as `mgarner@outlook.com` (Member role) returns HTTP 403

> **Reference files:**
> - `src/Stretto.Domain/Entities/AuditionDate.cs` — AuditionDate entity (Id, ProgramYearId, Date, StartTime, EndTime, BlockLengthMinutes, OrganizationId)
> - `src/Stretto.Domain/Entities/AuditionSlot.cs` — AuditionSlot entity (Id, AuditionDateId, SlotTime, MemberId, Status (AuditionStatus enum), Notes, OrganizationId)
> - `src/Stretto.Domain/Enums/AuditionStatus.cs` — AuditionStatus enum (Pending=0, Accepted=1, Rejected=2, Waitlisted=3)
> - `src/Stretto.Application/Services/ProjectService.cs` — pattern for Application-layer service: constructor-inject `IRepository<T>`, throw typed exceptions, return DTO records
> - `src/Stretto.Api/Controllers/ProjectsController.cs` — pattern for thin controller: `GetSessionAsync()` helper, delegate to service, return HTTP result
> - `src/Stretto.Api/Program.cs` — register the new service with `builder.Services.AddScoped<IAuditionService, AuditionService>()`

- [ ] Create `src/Stretto.Application/DTOs/AuditionDtos.cs` with four records: `AuditionDateDto(Guid Id, Guid ProgramYearId, DateOnly Date, TimeOnly StartTime, TimeOnly EndTime, int BlockLengthMinutes, int SlotCount)`; `AuditionSlotDto(Guid Id, Guid AuditionDateId, TimeOnly SlotTime, Guid? MemberId, string Status, string? Notes)`; `CreateAuditionDateRequest(Guid ProgramYearId, DateOnly Date, TimeOnly StartTime, TimeOnly EndTime, int BlockLengthMinutes)`; `UpdateAuditionSlotRequest(string Status, string? Notes)`

- [ ] Create `src/Stretto.Application/Interfaces/IAuditionService.cs` with six method signatures: `Task<List<AuditionDateDto>> ListByProgramYearAsync(Guid programYearId, Guid orgId)`; `Task<AuditionDateDto> GetAuditionDateAsync(Guid id, Guid orgId)`; `Task<AuditionDateDto> CreateAuditionDateAsync(Guid orgId, CreateAuditionDateRequest req)`; `Task DeleteAuditionDateAsync(Guid id, Guid orgId)`; `Task<List<AuditionSlotDto>> GetSlotsAsync(Guid auditionDateId, Guid orgId)`; `Task<AuditionSlotDto> UpdateSlotAsync(Guid auditionDateId, Guid slotId, Guid orgId, UpdateAuditionSlotRequest req)`

- [ ] Create `src/Stretto.Application/Services/AuditionService.cs` implementing `IAuditionService`; constructor-inject `IRepository<AuditionDate>`, `IRepository<AuditionSlot>`, and `IRepository<ProgramYear>`; `ListByProgramYearAsync` calls `_dates.ListAsync(orgId, d => d.ProgramYearId == programYearId)`, maps each to `AuditionDateDto` (compute `SlotCount` as `(int)((d.EndTime - d.StartTime).TotalMinutes / d.BlockLengthMinutes)`); `GetAuditionDateAsync` calls `GetByIdAsync(id, orgId)`, throws `NotFoundException("Audition date not found")` if null; `CreateAuditionDateAsync` fetches program year with `_programYears.GetByIdAsync(req.ProgramYearId, orgId)` (throw `NotFoundException("Program year not found")` if null), validates that `(int)(req.EndTime - req.StartTime).TotalMinutes % req.BlockLengthMinutes == 0` (throw `ValidationException(new Dictionary<string,string[]>{["blockLengthMinutes"]=["Block length must divide evenly into the total duration"]})` if not), creates `AuditionDate` entity and calls `_dates.AddAsync`, then generates slots by looping `current = req.StartTime` while `current < req.EndTime`, creating one `AuditionSlot` per iteration with `Id = Guid.NewGuid()`, `AuditionDateId = date.Id`, `SlotTime = current`, `Status = AuditionStatus.Pending`, `OrganizationId = orgId`, `MemberId = null`, `Notes = null`, advancing `current` by `TimeSpan.FromMinutes(req.BlockLengthMinutes)`, and calling `_slots.AddAsync` for each; returns `AuditionDateDto` with `SlotCount` equal to the number of slots generated; `DeleteAuditionDateAsync` fetches by id/orgId (throw `NotFoundException` if null), then deletes all slots via `_slots.ListAsync(orgId, s => s.AuditionDateId == id)` and calls `_slots.DeleteAsync` for each before calling `_dates.DeleteAsync`; `GetSlotsAsync` calls `_slots.ListAsync(orgId, s => s.AuditionDateId == auditionDateId)` (verify the date exists first, throw `NotFoundException` if null), maps to `AuditionSlotDto` with `Status = slot.Status.ToString()`; `UpdateSlotAsync` fetches the audition date (throw `NotFoundException("Audition date not found")` if null), fetches the slot via `_slots.GetByIdAsync(slotId, orgId)` (throw `NotFoundException("Slot not found")` if null or if `slot.AuditionDateId != auditionDateId`), parses `req.Status` to `AuditionStatus` enum (throw `ValidationException(new Dictionary<string,string[]>{["status"]=["Invalid status value"]})` if unrecognised), sets `slot.Status` and `slot.Notes = req.Notes`, calls `_slots.UpdateAsync(slot)`, returns updated `AuditionSlotDto`; include private `ToDateDto(AuditionDate d, int slotCount)` and `ToSlotDto(AuditionSlot s)` helpers

- [ ] Register `IAuditionService` in `src/Stretto.Api/Program.cs`: add `builder.Services.AddScoped<IAuditionService, AuditionService>();` after the `AddScoped<IProjectService, ProjectService>()` line

- [ ] Create `src/Stretto.Api/Controllers/AuditionDatesController.cs` with `[ApiController]`, `[Route("api/audition-dates")]`; constructor-inject `IAuditionService` and `IAuthService`; add private `GetSessionAsync()` helper (read `stretto_session` cookie, throw `UnauthorizedException` if null, call `_authService.ValidateAsync`, throw `UnauthorizedException` if result is null, return `(dto.OrgId, dto.Role)`); implement: `GET /api/audition-dates?programYearId={id}` → calls `GetSessionAsync()`, returns 400 if `programYearId` is null, calls `ListByProgramYearAsync`, returns `Ok(list)`; `GET /api/audition-dates/{id}` → calls `GetSessionAsync()`, calls `GetAuditionDateAsync(id, orgId)`, returns `Ok(dto)`; `POST /api/audition-dates` → requires Admin role (throw `ForbiddenException("Only admins can manage auditions")` otherwise), calls `CreateAuditionDateAsync`, returns `Created($"/api/audition-dates/{dto.Id}", dto)`; `DELETE /api/audition-dates/{id}` → requires Admin role, calls `DeleteAuditionDateAsync`, returns `NoContent()`; `GET /api/audition-dates/{id}/slots` → calls `GetSessionAsync()`, calls `GetSlotsAsync(id, orgId)`, returns `Ok(slots)`; `PATCH /api/audition-dates/{id}/slots/{slotId}` → requires Admin role, calls `UpdateSlotAsync(id, slotId, orgId, req)`, returns `Ok(dto)`

- [ ] Regenerate the TypeScript client: run `cd src/Stretto.Web && npm run generate` so the new `/api/audition-dates` endpoints appear in `src/Stretto.Web/src/api/generated/`
